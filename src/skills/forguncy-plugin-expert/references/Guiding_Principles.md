# 插件开发指导原则：简洁安全 (Simplicity & Safety)

本指南定义了活字格插件开发的最高准则，旨在避免过度设计，确保工程的高效与稳定。

## 1. 简洁 (Simplicity) —— 消除冗余，直击本质

### 1.1 API 设计极简主义
- **原则**：只暴露业务语义，隐藏技术细节。
- **做法**：如果一个参数可以通过插件已有的属性配置推导出来，应在代码内部进行智能推断，严禁将内部状态（如 `isUpdate`）暴露给终端用户。
- **目标**：让非技术用户也能通过直觉配置插件。

### 1.2 逻辑复用与抽象
- **原则**：严禁在 `onRender` 和 `updateData` 中编写重复的数据转换逻辑。
- **做法**：强制将“原始数据 -> 视图模型”的转换提取为独立的纯函数（Pure Function）。
- **目标**：降低维护成本，确保更新逻辑与初始化逻辑的高度一致。

### 1.3 文档与工程扁平化
- **原则**：避免过度碎裂的文件结构。
- **做法**：优先使用聚合的参考文档（如《统一属性指南》），而非为每个微小特性创建单独的 Markdown 文件。
- **目标**：提高 AI 检索效率，降低开发者的阅读负担。

---

## 2. 安全 (Safety) —— 稳健运行，防患未然

### 2.1 环境与生命周期安全
- **IGenerateContext 隔离**：它是请求作用域的，**严禁**缓存到静态变量中，防止多用户并发时的数据串扰。
- **JS 同步约束**：`createContent`、`onRender` 等生命周期方法**严禁使用 async**。必须同步返回 DOM 占位符，异步更新内容。

### 2.2 数据与查询安全
- **参数化查询**：在 C# 服务端操作数据库时，必须使用 `context.DataAccess.ExecuteNonQuery(sql, param)`，严禁字符串拼接 SQL。
- **输入净化**：对所有来自公式或用户输入的字符串进行必要的合法性检查。

### 2.3 错误处理与可观测性
- **禁止静默失败**：关键逻辑必须包裹在 `try-catch` 中，并通过活字格 Logger 记录异常。
- **统一日志前缀**：所有前端日志必须带有 `[PluginName]` 前缀，方便在浏览器控制台快速过滤。

---

## 3. 避免过度设计 (No Over-engineering)

- **按需扩展**：不要为了“未来可能用到”而编写复杂的基类或框架代码。
- **设计器预览按需开启 (Designer Preview On-Demand)**：
    - **核心原则**：除非用户明确提到“设计器预览”、“所见即所得”或“设计时显示”等需求，否则**严禁**主动提示、生成或引导用户开发设计器预览相关的复杂逻辑（如 `isDesignerPreview` 判断、WPF 绘制等）。
    - **理由**：设计器预览会显著增加 JS 和 C# 代码的复杂度，对于简单的逻辑处理型插件，应保持代码极简。
- **首选内置功能**：如果活字格内置功能可以实现，不要通过插件重复造轮子。
- **保持目录整洁**：定期清理 `plans/` 下的旧计划，移除不再使用的模板和脚本。
