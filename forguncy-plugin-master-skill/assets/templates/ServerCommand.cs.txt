using System;
using System.ComponentModel;
using System.Threading.Tasks;
using GrapeCity.Forguncy.Commands;
using GrapeCity.Forguncy.Plugin;

namespace MyPluginNamespace
{
    [Icon("pack://application:,,,/MyPluginNamespace;component/Resources/Icon.png")]
    public class MyServerCommand : Command, ICommandExecutableInServerSideAsync
    {
        [DisplayName("示例属性")]
        [FormulaProperty]
        public object SampleProperty { get; set; }

        public async Task<ExecuteResult> ExecuteAsync(IServerCommandExecuteContext context)
        {
            try
            {
                // 1. Evaluate Formula
                var value = await context.EvaluateFormulaAsync(SampleProperty);

                // 2. Perform Logic
                // TODO: Implement your business logic here.
                // Example: string result = DoSomething(value);

                // 3. Return Result
                return new ExecuteResult();
            }
            catch (Exception ex)
            {
                return new ExecuteResult
                {
                    Message = ex.Message
                };
            }
        }

        public override string ToString()
        {
            // 在活字格命令列表中显示的名称。建议格式：命令名: 关键参数描述
            return "我的服务端命令"; 
        }

        public override CommandScope GetCommandScope()
        {
            return CommandScope.ExecutableInServer;
        }

        /* 
        // 示例：动态属性可见性 (Dynamic Property Visibility)
        // 根据其他属性的值控制某个属性在设计器中是否显示。
        public override bool GetDesignerPropertyVisible(string propertyName, CommandScope commandScope)
        {
            if (propertyName == nameof(SampleProperty))
            {
                // return SomeOtherProperty == true; // 仅当 SomeOtherProperty 为 true 时显示
                return true;
            }
            return base.GetDesignerPropertyVisible(propertyName, commandScope);
        }
        */
    }
}
