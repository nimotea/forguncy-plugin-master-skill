
## 15. 架构设计原则：高内聚与低耦合 (High Cohesion & Low Coupling)

在开发服务端命令插件时，除了代码层面的技巧，**架构设计**同样至关重要。一个优秀的插件应当是“积木”的集合，而不是一个不可拆分的“黑盒”。

### 核心理念：积木 vs 黑盒

-   **反模式 (Anti-Pattern)：上帝命令 (God Command)**
    -   试图在一个命令中处理所有可能的业务场景。
    -   特征：拥有 20+ 个属性，内部充斥着大量的 `if (Mode == A)` 判断，试图在代码中硬编码所有的业务流程。
    -   **后果**：
        -   **维护灾难**：修改 A 模式的逻辑可能会意外破坏 B 模式的功能。
        -   **灵活性丧失**：用户无法在两个步骤中间插入自定义逻辑（如发送邮件、记录日志）。
        -   **测试困难**：几乎无法覆盖所有的参数组合路径。

-   **最佳实践 (Best Practice)：原子化积木**
    -   遵循**单一职责原则 (SRP)**：一个命令只做一件事，并且做好。
    -   **特征**：属性少而精（通常 < 10 个），逻辑线性，无副作用。
    -   **组合的力量**：利用活字格设计器强大的**服务端命令逻辑流**，让用户通过拖拉拽的方式，将你的“原子命令”组合成复杂的业务流程。

### 兜底自查清单

当你发现自己的插件出现以下情况时，请立即停下来重构：

1.  **属性过多**：单个命令的属性超过 **15 个**。
2.  **职责不清**：命令名称包含“和/或” (e.g., `CreateOrUpdateOrderAndSendEmail`)。
3.  **流程固化**：在 C# 代码中硬编码了 `A -> B -> C` 的顺序，导致用户无法只执行 `A -> C`。

### 重构示例

**Bad Design (高耦合):**
-   命令：`处理订单 (ProcessOrder)`
-   属性：`创建订单?`, `支付订单?`, `发货?`, `发送邮件?` ...
-   逻辑：内部强绑定了整个电商流程。

**Good Design (高内聚):**
-   命令 A：`创建订单 (CreateOrder)`
-   命令 B：`支付订单 (PayOrder)`
-   命令 C：`发货 (ShipOrder)`
-   **用户侧**：用户可以在服务端命令设计器中，先拖入 `创建订单`，然后加一个 `发送邮件` (活字格内置命令)，再拖入 `支付订单`。这种灵活性是“上帝命令”无法提供的。

**记住：插件开发者的职责是提供“积木”，而不是搭建“城堡”。让用户（低代码开发者）去决定城堡的样子。**
